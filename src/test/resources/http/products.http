@env = local
@baseUrl = http://localhost:8080

### Register test user
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "fakeuser@example.com",
  "password": "secret123",
  "displayName": "Fake User"
}

###login
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "testuser@example.com",
  "password": "secret123"
}
> {%
    const body = JSON.parse(response.body || "{}");

    client.environment.set("jwtToken", body.token);
    client.environment.set("authHeader", "Bearer " + body.token);
%}



### Verify token - get current user
GET {{baseUrl}}/api/auth/me
Accept: application/json
Authorization: {{authHeader}}



### Create product (as authenticated user)
POST {{baseUrl}}/api/products
Content-Type: application/json
Authorization: {{authHeader}}

{
  "name": "Test Product 1",
  "quantityBought": 10.0,
  "quantityConsumed": 7.0,
  "unit": "l",
  "purchaseDate": "2025-11-30",
  "expirationDate": "2026-11-30",
  "notificationFrequency": "WEEKLY",
  "tags": ["dairy","fridge"]
}
> {%
    var body = JSON.parse(response.body || "{}");
    // store created product id and ensure userId is set
    client.env.set("productId", body.id || body._id || "");
    client.global.set("userId", client.global.get("userId") || body.userId || "");
%}


### Get product by id (as authenticated user)
GET {{baseUrl}}/api/products/{{productId}}
Accept: application/json
Authorization: {{authHeader}}

### analyze by id (as authenticated user)
GET {{baseUrl}}/api/products/analyze/{{productId}}
Accept: application/json
Authorization: {{authHeader}}


### Get products by user (as authenticated user)
GET {{baseUrl}}/api/products/user/{{userId}}
Accept: application/json
Authorization: {{authHeader}}



### Update product (as owner)
PUT {{baseUrl}}/api/products/{{productId}}
Content-Type: application/json
Authorization: {{authHeader}}

{
  "name": "Updated Product",
  "quantityBought": 12.0,
  "quantityConsumed": 3.0,
  "unit": "kg",
  "purchaseDate": "2025-12-01",
  "expirationDate": "2026-12-01",
  "notificationFrequency": "MONTHLY",
  "tags": ["updated","kitchen"]
}


### Delete product (as owner)
DELETE {{baseUrl}}/api/products/{{productId}}
Authorization: {{authHeader}}



### Verify deletion (should return 404 / not found) (as owner)
GET {{baseUrl}}/api/products/{{productId}}
Accept: application/json
Authorization: {{authHeader}}



### Patch - update quantityConsumed (happy path)
PATCH {{baseUrl}}/api/products/{{productId}}/quantity-consumed
Content-Type: application/json
Authorization: {{authHeader}}

{
  "quantityConsumed": 12.0
}


### Patch - update quantityConsumed (error: exceeds quantityBought)
PATCH {{baseUrl}}/api/products/{{productId}}/quantity-consumed
Content-Type: application/json
Authorization: {{authHeader}}

{
  "quantityConsumed": 50.0
}


### PATCH - update notification frequency (change to DAILY)
PATCH {{baseUrl}}/api/products/{{productId}}/notification-frequency
Content-Type: application/json
Authorization: {{authHeader}}

{
  "notificationFrequency": "DAILY"
}


### PUT - replace tags (replace all tags)
PUT {{baseUrl}}/api/products/{{productId}}/tags
Content-Type: application/json
Authorization: {{authHeader}}

{
  "tags": ["dairy","snack"]
}


### POST - add tags (merge new tags)
POST {{baseUrl}}/api/products/{{productId}}/tags
Content-Type: application/json
Authorization: {{authHeader}}

{
  "tags": ["sale","bulk"]
}


### DELETE - remove tags (remove the listed tags)
DELETE {{baseUrl}}/api/products/{{productId}}/tags
Content-Type: application/json
Authorization: {{authHeader}}

{
  "tags": ["fridge"]
}


### Pagination + sort - expirationDate desc
GET {{baseUrl}}/api/products/user/{{userId}}?pageNumber=1&pageSize=5&sortBy=expirationDate&sortDirection=desc
Accept: application/json
Authorization: {{authHeader}}


### Pagination + sort - status asc
GET {{baseUrl}}/api/products/user/{{userId}}?pageNumber=0&pageSize=5&sortBy=status&sortDirection=asc
Accept: application/json
Authorization: {{authHeader}}


### Pagination + sort - notificationFrequency asc
GET {{baseUrl}}/api/products/user/{{userId}}?pageNumber=0&pageSize=5&sortBy=notificationFrequency&sortDirection=asc
Accept: application/json
Authorization: {{authHeader}}


### Invalid sort field (expect 400 Bad Request) (as owner user1)
GET {{baseUrl}}/api/products/user/user1?sortBy=invalidField
Accept: application/json
Authorization: {{authHeader}}


### Invalid page params (negative pageNumber) (expect 400 Bad Request) (as owner user1)
GET {{baseUrl}}/api/products/user/user1?pageNumber=-1&pageSize=10
Accept: application/json
Authorization: {{authHeader}}


### Large pageSize (smoke) - observe behavior (as owner user1)
GET {{baseUrl}}/api/products/user/user1?pageNumber=0&pageSize=1000&sortBy=name&sortDirection=asc
Accept: application/json
Authorization: {{authHeader}}
### Debug vars
GET https://httpbin.org/headers
Authorization: {{authHeader}}